# TaskManager

Это асинхронное веб-приложение на FastAPI для управления задачами и пользователями с реализацией аутентификации, авторизации, а также нотификаций в реальном времени через WebSocket.

## Архитектура

Используются репозитории (**Repository pattern**) для абстракции работы с базой данных — слой доступа к данным.
Введён шаблон **Unit of Work** (UoW) для управления транзакциями и согласованности данных.
Сервисный слой реализует бизнес-логику, используя репозитории из UoW.
Слой API (ручки, routers) обрабатывает HTTP-запросы, вызывает сервисы. Основной функционал покрыт тестами.

## Основные компоненты

### 1. Authentication & Authorization
* Аутентификация через **JWT-токены**.
* **PermissionChecker** — декоратор проверки ролей (user, admin).
* Особенность: при GET запросах к пользователям допускается доступ пользователю (`roles == ["user"]`), если он запрашивает свои данные (сравнение ID).

### 2. API ручки

* **Tasks Router** `/tasks`:
  + Получение списка задач (доступно user и выше).
  + CRUD операции по задачам (создание, обновление, удаление, назначение и отмена назначения) — доступно только admin.

* **Users Router** `/users`:
  + Регистрация нового пользователя.
  + Логин, возвращающий JWT-токен. 
  + Получение списка пользователей и CRUD операции — доступно только admin.
  + Пользователь может получить свои данные (`GET /users/{user_id}`), если совпадает ID.

### 3. WebSocket
Маршрут `/ws/tasks/` позволяет пользователям подключаться и получать в реальном времени уведомления об изменениях задач:
* Создание задачи.
* Удаление задачи.
* Обновление задачи.
* Назначение/снятие пользователя с задачи.

### 4. Сервисы
* **TaskService** — методы для получения, создания, обновления, удаления задач и управления назначениями пользователей.
* **UserService** — методы для управления пользователями и аутентификации.
* Все методы оформлены с декоратором логирования.

## Роли и права доступа
| Роль      | Доступные операции                                              |
|-----------|-----------------------------------------------------------------|
| **user**  | Просмотр своих задач и данных                                   |
| **admin** | Полный доступ к задачам и пользователям, включая CRUD операции  |



## Запуск проекта
### 1. Создайте файл **.env** на основе **.env.example**
### 2. Запустите приложение командой:

    docker-compose --env-file .env up -d


## Пример использования
* Зарегистрировать пользователя: `POST /users/`
* Авторизоваться: `POST /users/login/` → получить JWT
* Использовать JWT в заголовке **Authorization** для доступа к остальным ручкам.
* Получить список задач: `GET /tasks/` (роль user или admin)
* Создать задачу: `POST /tasks/` (только admin)
* Подписаться на WebSocket `/ws/tasks/` для получения уведомлений о задачах.

